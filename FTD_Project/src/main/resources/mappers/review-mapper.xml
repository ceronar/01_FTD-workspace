<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="reviewMapper">

	<resultMap id="reviewResultSet" type="review">
		<result column="REV_NO" property="revNo" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="GOOD_NO" property="goodNo" />
		<result column="REV_TITLE" property="revTitle" />
		<result column="REV_CONTENT" property="revContent" />
		<result column="COUNT" property="count" /> <!-- 별칭 -->
		<result column="STAR_RATING" property="starRatting" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="DELETE_DATE" property="deleteDate" />
	</resultMap>

	<resultMap id="reviewFileResultSet" type="reviewFile">
		<result column="FILE_NO" property="fileNo"/>
		<result column="REV_NO" property="revNo" />
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="CREATE_DATE" property="createDate" />
		<result column="DELETE_DATE" property="deleteDate"/>
	</resultMap>
	
	<resultMap id="reviewReplyResultSet" type="reviewReply">
		<result column="REPLY_NO" property="replyNo"/>
		<result column="REV_NO" property="promotionNo" />
		<result column="MEMBER_NO" property="memberNo"/>
		<result column="REPLY_CONTENT" property="replyContent"/>
		<result column="CREATE_DATE" property="createDate" />
		<result column="DELETE_DATE" property="deleteDate"/>
	</resultMap>

	<select id="selectReviewList" resultMap="reviewResultSet">
		SELECT 
		    R.REV_NO,
		    R.MEMBER_NO,
		    R.GOOD_NO,
		    R.REV_TITLE,
		    R.REV_CONTENT,
		    R.COUNT,
		    R.STAR_RATING,
		    R.CREATE_DATE,
		    R.DELETE_DATE
		FROM 
		    REVIEW R
		JOIN 
		    MEMBER M ON R.MEMBER_NO = M.MEMBER_NO
		JOIN 
		    GOODS G ON R.GOOD_NO = G.GOOD_NO
		WHERE 
		    M.STATUS IS NULL
		    AND R.DELETE_DATE IS NULL
		    AND G.DELETE_DATE IS NULL
		ORDER BY 
		    R.REV_NO DESC
	</select>
	
	<select id="selectReviewFileList" resultMap="reviewFileResultSet" parameterType="_int">
    SELECT *
		FROM REVIEW_FILE
		WHERE REV_NO = ${revNo}
		AND DELETE_DATE IS NULL   
	</select>
	
	<select id="ReviewReplyCount" resultType="_int" parameterType="_int">
	  SELECT COUNT(*) COUNT
		  FROM REVIEW_REPLY
		 WHERE REV_NO = ${revNo}
		 AND DELETE_DATE IS NULL
	</select>

</mapper>